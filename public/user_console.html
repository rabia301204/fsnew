<!DOCTYPE html>
<html lang="en" ng-app="adminApp">
<head>
  <meta charset="UTF-8">
  <title>User Admin Console</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body ng-controller="adminController">
<div class="container mt-5">
  <h2 class="text-center mb-4 fw-bold">User Admin Console</h2>
  <div class="table-responsive">
    <table class="table table-bordered text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>Email ID</th>
          <th>Password</th>
          <th>User Type</th>
          <th>Date of Joining</th>
          <th>Status</th>
          <th>Operations</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="user in users">
          <td>{{user.emailid}}</td>
          <td>{{user.pwd}}</td>
          <td>{{user.usertype}}</td>
          <td>{{user.dos | date:'yyyy-MM-dd'}}</td>
          <td>
            <span class="badge" ng-class="user.status == 1 ? 'bg-success' : 'bg-danger'">
              {{user.status == 1 ? 'Active' : 'Blocked'}}
            </span>
          </td>
          <td>
            <button ng-if="user.status == 1"
                    class="btn btn-danger btn-sm"
                    ng-click="changeStatus(user.emailid, 0)">Block</button>
            <button ng-if="user.status == 0"
                    class="btn btn-success btn-sm"
                    ng-click="changeStatus(user.emailid, 1)">Resume</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
var app = angular.module("adminApp", []);
app.controller("adminController", function($scope, $http) {
  $scope.users = [];

  function fetchUsers() {
    $http.get("/get-all-users").then(function(response) {
      $scope.users = response.data;
    }, function(error) {
      alert("Error fetching users");
    });
  }

  $scope.changeStatus = function(emailid, newStatus) {
    $.ajax({
      url: "/change-user-status",
      method: "POST",
      data: {
        emailid: emailid,
        status: newStatus
      },
      success: function(response) {
        alert("Status updated successfully");
        fetchUsers(); // reload list
      },
      error: function(err) {
        alert("Failed to update status: " + err.responseText);
      }
    });
  };

  fetchUsers(); // Initial load
});
</script>
</body>
</html>
