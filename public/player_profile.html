<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Player Details Form</title>

  <!-- Bootstrap & jQuery -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

  <!-- AngularJS (optional if you're using it somewhere else) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"
    integrity="sha512-KZmyTq3PLx9EZl0RHShHQuXtrvdJ+m35tuOiwlcZfs/rE7NZv29ygNA8SFCkMXTnYZQK2OX0Gm2qKGfvWEtRXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    .form_style {
      max-width: 700px;
      margin: 40px auto;
      border-style: ridge;
      padding-bottom: 20px;
    }
  </style>

  <script>
    // Show preview image
    function showPrev(fileRef, prevRef) {
      const [file] = fileRef.files;
      if (file) {
        prevRef.src = URL.createObjectURL(file);
      }
    }

    // Fill form from AJAX
    $(document).ready(function () {
      $("#btnFetchWithAjax").click(function (e) {
        e.preventDefault(); // prevent form submission
        let obj = {
          type: "get",
          url: "/fetch-player-details",
          data: {
            emailid: $("#emailid").val()
          }
        };

            $.ajax(obj).then(
            function (responseJsonAry) {
            console.log("AJAX response:", responseJsonAry);
            let player = responseJsonAry[0];

            $("#emailid").val(player.emailid);
            $("#name").val(player.name);
            $("#dob").val(player.dob);
            $("#gender").val(player.gender);
            $("#address").val(player.address);
            $("#contact").val(player.contact);
            $("#game").val(player.game);
            $("#otherinfo").val(player.otherinfo);

            $("#prev").prop("src", player.adharpic);
            $("#prev2").prop("src", player.profilepic);

            $("#hdn").val(player.adharpic);
            $("#hdn2").val(player.profilepic);
          })
          .fail(function (err) {
            alert(err.message);
          });
      });
    });

    // Load active user from localStorage
    function showUser() {
      let activeUser = localStorage.getItem("activeUser");
      document.getElementById("emailid").value = activeUser;
    }
  </script>
</head>

<body onload="showUser()">
  <div class="container row mx-auto">
    <form class="row g-3 form_style" method="post" enctype="multipart/form-data" id="playerform" action="/profile-player">
      <input type="hidden" id="hdn" name="hdn">
      <input type="hidden" name="hdn2" id="hdn2">

      <h3 class="text-center mb-4">Player Details Form</h3>

      <div class="col-md-8">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" id="emailid" name="emailid">
      </div>
      <div class="col-md-4">
        <label><br></label>
        <input type="submit" class="btn btn-dark w-100" value="Search" id="btnFetchWithAjax">
      </div>

      <div class="col-md-6">
        <label class="form-label">Aadhaar Card Pic</label>
        <input class="form-control" type="file" name="adharpic" id="adharpic" onchange="showPrev(this, prev)">
        <img src="" width="100" height="100" id="prev" alt="Aadhaar preview">
      </div>

      <div class="col-md-6">
        <label class="form-label">Profile Pic</label>
        <input class="form-control" type="file" name="profilepic" id="profilepic" onchange="showPrev(this, prev2)">
        <img src="" width="100" height="100" id="prev2" alt="Profile preview">
      </div>

      <div class="col-md-6">
        <label class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name" />
      </div>

      <div class="col-md-6">
        <label class="form-label">Date of Birth</label>
        <input type="date" class="form-control" id="dob" name="dob" >
      </div>

      <div class="col-md-6">
        <label class="form-label">Gender</label>
        <select id="gender" name="gender" class="form-select" >
          <option selected>Choose...</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Don't Prefer to Say</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Address</label>
        <input type="text" class="form-control" id="address" name="address">
      </div>

      <div class="col-md-6">
        <label class="form-label">Contact</label>
        <input type="number" class="form-control" id="contact" name="contact">
      </div>

      <div class="col-md-6">
        <label class="form-label">Game</label>
        <select id="game" name="game" class="form-select">
                        <option selected>Choose...</option>
                        <option>Cricket</option>
                        <option>Badminton</option>
                        <option>Tennis</option>
                        <option>FootBall</option>
                        <option>BaseBall</option>
                        <option>Archery</option>
                        <option>SoftBall</option>
                    </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Other Information</label>
        <textarea class="form-control" id="otherinfo" name="otherinfo" style="height: 100px"></textarea>
      </div>

      <div class="col-md-8 mt-3">
        <button type="submit" id="submitOrg" class="btn btn-primary">Submit</button>
      </div>

      <div class="col-md-4 mt-3">
        <button type="submit" class="btn btn-primary" formaction="/update-player">Modify</button>
      </div>
    </form>
  </div>
</body>
</html>
